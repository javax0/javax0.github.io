<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Use of optional is optional | Java Deep, mostly Java</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Use of optional is optional" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="After the article of last week &quot;Optional in collections&quot; today I can&#8217;t help but talking a bit more about the same beast. A bit more detail." />
<meta property="og:description" content="After the article of last week &quot;Optional in collections&quot; today I can&#8217;t help but talking a bit more about the same beast. A bit more detail." />
<link rel="canonical" href="http://localhost:4000/2015/09/02/use-of-optional-is-optional.html" />
<meta property="og:url" content="http://localhost:4000/2015/09/02/use-of-optional-is-optional.html" />
<meta property="og:site_name" content="Java Deep, mostly Java" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-09-02T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Use of optional is optional" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2015-09-02T00:00:00+02:00","datePublished":"2015-09-02T00:00:00+02:00","description":"After the article of last week &quot;Optional in collections&quot; today I can&#8217;t help but talking a bit more about the same beast. A bit more detail.","headline":"Use of optional is optional","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2015/09/02/use-of-optional-is-optional.html"},"url":"http://localhost:4000/2015/09/02/use-of-optional-is-optional.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Java Deep, mostly Java" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Java Deep, mostly Java</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/about/">About</a><a class="page-link" href="/">Java Deep</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Use of optional is optional</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2015-09-02T00:00:00+02:00" itemprop="datePublished">Sep 2, 2015
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="paragraph">
<p>After the article of last week <a href="https://javax0.wordpress.com/2015/08/26/optional-in-collections/">"Optional in collections"</a> today I can&#8217;t help but talking a bit more about the same beast. A bit more detail.</p>
</div>
<div class="paragraph">
<p>The class <code>Optionial</code> originally introduced by Google Guava and later included in the Java 8 package is simply a wrapper that wraps an optional object. The wrapped object is optional in the sense that it is either there or there is no object in the wrapping, in which case it is empty. There is not too much magic there. The wrapping code, the class <code>Optional</code> insist that the object wrapped is not <code>null</code>. After all <code>null</code> is <code>null</code> and not an object. An object is never <code>null</code>. Only a reference to an object can be <code>null</code>.</p>
</div>
<div class="paragraph">
<p>These are nuances, fine details; but important fine details. After all, these fine details are those that required the introduction of <code>Optional</code>. Average java coder does not see the importance of such tiny details. They think that <code>Optional</code> is just as good as a variable to the wrapped object itself assuming that the variable can also be <code>null</code>. At some level they are right. At their own level.</p>
</div>
<div class="paragraph">
<p>That level says that the good code works, can be understood and that is it. Most of enterprise legacy code that run banks, insurance companies, pace makers and weapons were made on this level. You can not do about it, just hope that you have the luck and a software bug will not select your house, bank account or body (in case of medical device) in a "bomb" explode there. What you can do is to understand the issue and do your part to slowly improve the situation. It will take a few generations unless we all are wiped out before that.</p>
</div>
<div class="paragraph">
<p>"Code working" and "possible to understand" are the very basic requirement for software. Some old times we said that if the software runs then it was ok and for the maintenance it was enough if there were two "person" who could understand the code: the coder who created it and God, who created the coder. Fortunately there are also levels higher. (I mean above the coder. Not above God.)</p>
</div>
<div class="paragraph">
<p>"Code working" and "easy (not so hard) to understand" are the next level. This is important in case you have to debug the code and need to identify the root cause of some malfunction. "Code working" and "easy to modify" are again new steps up the ladder. I had seen code that I could easily understand. The code was running. But the dependencies between the different modules were so complex like a macrame or a traditional Italian spagetti. Wherever I wanted to change something to fix a bug here, there were a few other places where the program started to fail. Easy to modify: that code was not.</p>
</div>
<div class="paragraph">
<p>The next level is "code working", "easy to modify" <em>and</em> "hard to create bad modifications". This means that the code provides style and internal data structures and APIs that the maintaining person will follow to some level and will create a working modified code that still works, easy to understand and to modify. This is the point where we get to the point of <code>Optional</code>.</p>
</div>
<div class="paragraph">
<p>When a method returns <code>Optional</code> is says that it may return something or just nothing. <code>Optional&lt;Integer&gt;</code> may return an <code>Integer</code> but it may just return an empty <code>Optional</code>, which means: there was no <code>Integer</code> that I could return. Why is it any better than returning an <code>Integer</code> that may optionally be <code>null</code>?</p>
</div>
<div class="sect2">
<h3 id="1-1-optional-method-return-value">1.1. Optional method return value</h3>
<div class="paragraph">
<p>The answer is that in case of returned <code>Optional&lt;Integer&gt;</code> you can not</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">integer = methodReturningIntegerOrNull();
otherInteger = integer +1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>that causes NPE. Why you do that? Because you forget to check, and the JavaDoc mentions the possibility somewhere at the end of the description that is not visible in the mouse over window when you code. In case of <code>Optional&lt;Integer&gt;</code> you are forced to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">optionalInteger = methodReturningOptionalInteger();
if( optionalInteger.isPresent() ){
  otherInteger = optionalInteger.get() +1;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Still there is a small chance that you will write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">optionalInteger = methodReturningOptionalInteger();
otherInteger = optionalInteger.get() +1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>but in that case you deserve what you get.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><code>Optional</code> helps you to create more code and less documentation. It gives a semantic to pass on some optional value in a way that is harder to neglect than a nullable value. It says: I do not trust you handling <code>null</code> properly, therefore I give you a wrapped object so you have to handle optionality explicitly.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>If you consider that you can easily answer the questions</p>
</div>
<div class="ulist">
<ul>
<li>
<p>requiring <code>Optional&lt;Something&gt;</code> as a method argument</p>
</li>
<li>
<p>having a <code>private</code> field optional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>are good ideas.</p>
</div>
</div>
<div class="sect2">
<h3 id="1-2-optional-method-argument">1.2. Optional method argument</h3>
<div class="paragraph">
<p>There are pros and cons. When the argument says</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">countFrom(Optional&lt;Date&gt; from, Date to);</code></pre>
</div>
</div>
<div class="paragraph">
<p>it is clear that the <code>from</code> value may be missing and there should be some special default semantics when an absent value is passed. On the other hand the caller may pass <code>null</code> to get the special behavior. It is less likely that the caller will pass <code>null</code> just by mistake neglecting the optionality. Even if the argument is <code>Optional</code> the argument actually passed can still be <code>null</code> and I expect that the method throws NPE in this case. Last, but not least there is another danger introducing <code>Optional</code>: the caller may pass an <code>Optional</code> embracing an object that is not a <code>Date</code>. Generics can be circumvented in Java easy and a sloppy coder may pass a wrong <code>Optional</code>. It means that you have to implement assertions in your method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>argument is not null,</p>
</li>
<li>
<p>argument is of the proper type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also recall that <code>Optional</code>, in case of a method return value says: <em>I do not trust you handling <code>null</code> properly, therefore I give you a wrapped object so you have to handle optionality explicitly</em>. What would this message be when you create the API requiring <code>Optional</code> as an argument? <em>Please do not trust me! Give me only <code>Optional</code> because even I do not trust myself to handle a <code>null</code> value properly.</em> Weird&#8230;&#8203; <em>On the other hand I trust that you will not pass <code>null</code> or wrong type.</em></p>
</div>
<div class="paragraph">
<p>In my opinion: in this case using <code>Optional</code> does not deliver more value than having proper documentation for the API and does not force the caller to behave better than it would anyway. On the other side you put extra code on your own shoulder.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Give <code>Optional</code> to code you trust, accept it from code that does not trust your code but do not request it! Trust yourself!</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="1-3-private-optional-fields">1.3. Private Optional Fields</h3>
<div class="paragraph">
<p>When you declare a local, private field to be <code>Optional</code> you will force the developer of the class itself to pay more attention to the optional feature of the field. The cost of this is the extra wrapper, the extra clutter in the code handling optional. On the other side there is no much gain, because you can get the same level of quality extending your unit tests checking all cases where <code>null</code> value of the field is to be considered. Since all the code is in the hand of the current developer being responsible for the whole code there is no benefit of <code>Optional</code>. It is again, like you not trusting yourself. That is a serious issue needing more and different treatment than what <code>Optional</code> Java class can provide.</p>
</div>
</div>
<div class="sect2">
<h3 id="1-4-optional-in-functional-programming">1.4. Optional in functional programming</h3>
<div class="paragraph">
<p>You can use <code>Optional</code> to program Java in functional programming style if you want, but Java is not a functional language and optional and lambda and the functional style methods alone will not make it to be. But that is a different topic for later.</p>
</div>
</div>
<div class="sect2">
<h3 id="comments-imported-from-wordpress">Comments imported from Wordpress</h3>
<div class="paragraph">
<p><strong>Nicolai Parlog</strong> 2015-09-03 11:48:35</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Nice, more discussions about 'Optional'. :-)</p>
</div>
<div class="paragraph">
<p>You might have read <a href="http://blog.joda.org/2015/08/java-se-8-optional-pragmatic-approach.html">Stephen Colebourne&#8217;s post about 'Optional'</a> and <a href="http://blog.codefx.org/java/stephen-colebourne-optional-a-strict-approach/">my reply</a>. If so, you know that I disagree with your assessment regarding optional parameters and fields.</p>
</div>
<div class="paragraph">
<p>Specifically I think you should not assume that "me" writing a method or class and "me" modifying them are the same person. On the contrary, in a team with shared code ownership this is pretty unlikely. In such situations, 'Opional' helps immensely to communicate intent. (And way quicker and clearer than tests.)</p>
</div>
<div class="paragraph">
<p>I also fail to see "the extra clutter in the code handling optional". Coding for optionality is more succinct with 'Optional' than with regular references, see 'ifPresent' for example.</p>
</div>
<div class="paragraph">
<p>Finally and most importantly, you are missing one crucial aspect. If following your approach (no optional parameters, fields), null is still a legal value in some parts of the code. That means that if I encounter an NPE I am still forced to find out whether this value is even meant to exist. That&#8217;s wasting a lot of time.</p>
</div>
<div class="paragraph">
<p>If parameters and fields use 'Optional' as well, null is always a bug. Whenever I see null I already know something went wrong somewhere else and I can aggressively sprinkle null-tests anywhere because it can <span class="strong">never</span> be a legal value.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Peter Verhas</strong> 2015-09-03 12:55:10</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>I can absolutely accept your approach, arguments and conclusion. These issues are about the style and not carved in stone. Tastes can be different. If I were made to work in a group where the coding standard recommends, requires the approach you described I would not argue but follow the rules.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Mark</strong> 2015-09-03 21:33:23</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>While "pattern marching" could be a very researchy term that&#8217;d describe some obscure SW-technology phenomenon of codepatterns walking here and there but I need to admit, it&#8217;s just a typo of "pattern matching" which comes from the proximity of R and T on the keyboard :-(</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Peter Verhas</strong> 2015-09-03 22:17:48</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>lol</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Piotr Laskowski</strong> 2015-09-04 09:51:20</p>
</div>
<div class="quoteblock">
<blockquote>

</blockquote>
</div>
<div class="paragraph">
<p>Please do not trust me! Give me only Optional because even I do not trust myself to handle a null value properly. Weirdâ€¦ &lt;</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>I do not trust myself that after 3 months I will still remember details of given code. Optional is a doc in place, javadoc of public method is not. Especially when delegating work to private methods/helper classes. Not to mention the burden of keeping code and javadoc in sync.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>tamasrev</strong> 2015-09-04 12:30:29</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Using Optional as a private field&#8230;&#8203; It could make sense when you have a monster class with thousands of lines.
But wait! That&#8217;s below the 'possible to understand' level.</p>
</div>
<div class="paragraph">
<p>Still I find it a good idea: when you introduce an Optional into a huge legacy class, then the compiler will tell you when and how you need to check nulls.</p>
</div>
<div class="paragraph">
<p>And that&#8217;s it: leaning on the compiler is incredibly useful.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>Mark</strong> 2015-09-03 21:26:58</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Nice contemplation about Optional. It&#8217;s a good thing in my opinion that Java tries to solve , or at least give tools to cope with, "the dreadful NPE problem".</p>
</div>
<div class="paragraph">
<p>However, Optional without pattern marching is just a fancy word and an additional line of imports. Also it&#8217;s monadic properties are not exploitable (e.g. syntax-supported short-circuit of faulty operation).</p>
</div>
<div class="paragraph">
<p>TBH for me it seems Optional makes Java code only a slight more understandable while a lot more verbose. In Haskell, the Optional equivalent Maybe is a bliss: shortens code a lot while reduces "structure" (no more if-indentation hell), makes it way more comprehensible while helps you reason about your code.</p>
</div>
<div class="paragraph">
<p>In your argument,you distinguish between average and better coders. Average coders won&#8217;t start caring because of Optional. The more skilled, on the other hand, did already care: for them, it doesn&#8217;t matter whether they check for null or isPresent().</p>
</div>
</blockquote>
</div>
</div>


<!-- Disqus comments section goes here (if comments are enabled) -->

<hr/>
<h1>Comments</h1>
<p>Please leave your comments using Disqus, or just press one of the happy faces.
If for any reason you do not want to leave a comment here, <a href="https://github.com/javax0/javax0.github.io/issues">you can still create a Github ticket</a>.</p>
<div class="comments">
    <div id="disqus_thread"></div>

    <script type="text/javascript">

        /* * * STOP! * * */
        /* You shouldn't need to edit ANYTHING below to get this working! */
        /* Instead, edit the key `disqus.shortname` in _config.yml */

        var disqus_config = function (){
            this.page.url = 'http://localhost:4000/2015/09/02/use-of-optional-is-optional.html';
            this.page.identifier = '/2015/09/02/use-of-optional-is-optional.html';
        };

        (function() {
            var d = document, s = d.createElement('script');
            s.type = 'text/javascript'; s.async = true;
            s.src = 'https://javax0.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();

    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>




  </div><a class="u-url" href="/2015/09/02/use-of-optional-is-optional.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Java Deep, mostly Java</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Java Deep, mostly Java</li><li><a class="u-email" href="mailto:peter@verhas.com">peter@verhas.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/verhas"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">verhas</span></a></li><li><a href="https://www.twitter.com/verhas"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">verhas</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>javax0 is a technical Java oriented blog. Whenever I find something interesting, in the mood and feel the power to publish it, you will get it here. Publications are usually released on Wednesday 15:00am GMT. Earlier posts of the blog were published on Javax0 Wordpress Site at https://javax0.wordpress.com</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
